version: 2

models:
  - name: int_investors_resolved
    description: "Resolved investors from fund admin source using cross-reference table to map to canonical investor_id (preserves source lineage with one row per source system)"
    columns:
      - name: investor_id
        description: "Canonical investor identifier from xref_entities"
        tests:
          - not_null
      - name: source_system
        description: "Source system identifier (ADMIN)"
        tests:
          - not_null
      - name: source_id
        description: "Original investor identifier in source system"
        tests:
          - not_null
      - name: name
        description: "Investor name from source system"
        tests:
          - not_null
      - name: legal_name
        description: "Legal name of the investor"
      - name: investor_type_id
        description: "Investor type identifier"
        tests:
          - relationships:
              to: ref('stg_ref__investor_types')
              field: investor_type_id
      - name: country_code
        description: "Country code where investor is domiciled"
      - name: state_province
        description: "State or province"
      - name: city
        description: "City"
      - name: contact_person
        description: "Primary contact person"
      - name: contact_email
        description: "Contact email address"
      - name: contact_phone
        description: "Contact phone number"
      - name: kyc_status
        description: "Know Your Customer status"
      - name: aml_status
        description: "Anti-Money Laundering status"
      - name: accredited_status
        description: "Accredited investor status"
      - name: tax_id
        description: "Tax identification number"
      - name: tax_jurisdiction
        description: "Tax jurisdiction"
      - name: investment_capacity
        description: "Investment capacity level"
      - name: risk_tolerance
        description: "Risk tolerance level"
      - name: liquidity_preference
        description: "Liquidity preference"
      - name: esg_requirements
        description: "ESG requirements flag"
      - name: created_date
        description: "Record creation date in source system"
      - name: last_modified_date
        description: "Record last modified date in source system"

  - name: int_investors_unified
    description: "Unified investor dimension with all attributes matching canonical DBML structure, aggregated from multiple sources with priority rules (one row per canonical investor)"
    columns:
      - name: investor_id
        description: "Canonical investor identifier"
        tests:
          - unique
          - not_null
      - name: name
        description: "Investor name"
        tests:
          - not_null
      - name: investor_type_id
        description: "Investor type identifier"
        tests:
          - relationships:
              to: ref('stg_ref__investor_types')
              field: investor_type_id
      - name: country_code
        description: "Country code where investor is domiciled"
      - name: state_province
        description: "State or province"
      - name: city
        description: "City"
      - name: contact_person
        description: "Primary contact person"
      - name: contact_email
        description: "Contact email address"
      - name: contact_phone
        description: "Contact phone number"
      - name: kyc_status
        description: "Know Your Customer status"
      - name: aml_status
        description: "Anti-Money Laundering status"
      - name: accredited_status
        description: "Accredited investor status"
      - name: tax_id
        description: "Tax identification number"
      - name: tax_jurisdiction
        description: "Tax jurisdiction"
      - name: investment_capacity
        description: "Investment capacity level"
      - name: risk_tolerance
        description: "Risk tolerance level"
      - name: liquidity_preference
        description: "Liquidity preference"
      - name: esg_requirements
        description: "ESG requirements flag"
      - name: created_at
        description: "Earliest creation timestamp across all sources"
        tests:
          - not_null
      - name: updated_at
        description: "Latest update timestamp across all sources"
        tests:
          - not_null
