version: 2

models:
  - name: int_counterparties_resolved
    description: "Resolved counterparties from PM and fund admin sources using cross-reference table to map to canonical counterparty_id (preserves source lineage with one row per source system)"
    columns:
      - name: counterparty_id
        description: "Canonical counterparty identifier from xref_entities"
        tests:
          - not_null
      - name: source_system
        description: "Source system identifier (PM, ADMIN)"
        tests:
          - not_null
      - name: source_id
        description: "Original counterparty identifier in source system"
        tests:
          - not_null
      - name: name
        description: "Counterparty name from source system"
        tests:
          - not_null
      - name: type
        description: "Counterparty type (e.g., BANK, LENDER, AGENT)"
      - name: country_code
        description: "Country code where counterparty is domiciled"
      - name: created_date
        description: "Record creation date in source system"
      - name: last_modified_date
        description: "Record last modified date in source system"

  - name: int_counterparties_unified
    description: "Unified counterparty dimension with all attributes matching canonical DBML structure, aggregated from multiple sources with priority rules (PM > ADMIN) - one row per canonical counterparty"
    columns:
      - name: counterparty_id
        description: "Canonical counterparty identifier"
        tests:
          - unique
          - not_null
      - name: name
        description: "Counterparty name (unique in canonical model)"
        tests:
          - not_null
      - name: type
        description: "Counterparty type (e.g., BANK, LENDER, AGENT)"
      - name: country_code
        description: "Country code where counterparty is domiciled"
      - name: created_at
        description: "Earliest creation timestamp across all sources"
        tests:
          - not_null
      - name: updated_at
        description: "Latest update timestamp across all sources"
        tests:
          - not_null
