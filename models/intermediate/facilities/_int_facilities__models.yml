version: 2

models:
  - name: int_facilities_curated
    description: "Facilities curated from PM sources with entity resolution and canonical enum mapping"
    columns:
      - name: facility_id
        description: "Canonical facility identifier resolved through xref_entities"
        tests:
          - unique
          - not_null
      - name: fund_id
        description: "Canonical fund identifier that owns the facility"
        tests:
          - not_null
          - relationships:
              to: ref('int_funds_unified')
              field: fund_id
      - name: borrower_company_id
        description: "Canonical company identifier for the borrower"
        tests:
          - not_null
          - relationships:
              to: ref('int_companies_unified')
              field: company_id
      - name: facility_type
        description: "Type of facility (TERM_LOAN_B, UNITRANCHE, REVOLVER, DELAYED_DRAWDOWN, MEZZANINE, RCF, BRIDGE)"
        tests:
          - not_null
          - accepted_values:
              values: ['TERM_LOAN_B', 'UNITRANCHE', 'REVOLVER', 'DELAYED_DRAWDOWN', 'MEZZANINE', 'RCF', 'BRIDGE']
      - name: agreement_date
        description: "Date the facility agreement was signed"
        tests:
          - not_null
      - name: effective_date
        description: "Date the facility became effective (optional)"
      - name: maturity_date
        description: "Date the facility matures (optional)"
      - name: currency_code
        description: "Currency code for the facility"
        tests:
          - not_null
      - name: total_commitment
        description: "Total commitment amount for the facility"
      - name: purpose
        description: "Purpose of the facility"
      - name: created_at
        description: "Timestamp when the record was created"
      - name: updated_at
        description: "Timestamp when the record was last updated"
