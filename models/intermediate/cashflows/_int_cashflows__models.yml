version: 2

models:
  - name: int_instrument_cashflows_curated
    description: "Curated instrument-level cash movements from PM sources"
    columns:
      - name: instrument_cashflow_id
        description: "Unique instrument cashflow identifier (surrogate key)"
        tests:
          - unique
          - not_null
      - name: instrument_id
        description: "Canonical instrument identifier"
        tests:
          - not_null
          - relationships:
              to: ref('int_instruments_unified')
              field: instrument_id
      - name: instrument_cashflow_type
        description: "Type of cashflow (CONTRIBUTION, DISTRIBUTION, DIVIDEND, INTEREST, FEE, PRINCIPAL, DRAW, PREPAYMENT, PURCHASE, SALE, OTHER)"
        tests:
          - not_null
          - accepted_values:
              values: ['CONTRIBUTION', 'DISTRIBUTION', 'DIVIDEND', 'INTEREST', 'FEE', 'PRINCIPAL', 'DRAW', 'PREPAYMENT', 'PURCHASE', 'SALE', 'OTHER']
      - name: date
        description: "Cashflow date"
        tests:
          - not_null
      - name: amount
        description: "Cashflow amount in native currency"
        tests:
          - not_null
      - name: currency_code
        description: "Currency code for cashflow amount"
        tests:
          - not_null
      - name: fx_rate
        description: "Foreign exchange rate (base-per-native)"
      - name: fx_rate_as_of
        description: "Date of FX rate"
      - name: fx_rate_source
        description: "Source of FX rate"
      - name: amount_converted
        description: "Cashflow amount converted to base currency"
      - name: transaction_id
        description: "Reference to source transaction"
      - name: reference
        description: "External reference or identifier"
      - name: non_cash
        description: "Flag indicating if this is a non-cash transaction"
      - name: created_at
        description: "Record creation timestamp"
        tests:
          - not_null
      - name: updated_at
        description: "Record last update timestamp"
        tests:
          - not_null
