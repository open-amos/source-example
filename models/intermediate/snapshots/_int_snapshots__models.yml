version: 2

models:
  - name: int_fund_snapshots_curated
    description: "Curated fund-level performance snapshots from fund administration system"
    columns:
      - name: fund_snapshot_id
        description: "Unique fund snapshot identifier (surrogate key)"
        tests:
          - unique
          - not_null
      - name: fund_id
        description: "Canonical fund identifier"
        tests:
          - not_null
          - relationships:
              to: ref('int_funds_unified')
              field: fund_id
      - name: period_end_date
        description: "Snapshot period end date"
        tests:
          - not_null
      - name: frequency
        description: "Reporting frequency (QUARTERLY, ANNUAL)"
      - name: reporting_basis
        description: "Reporting basis (GAAP, IFRS)"
      - name: snapshot_source
        description: "Source of snapshot data (ADMIN, INTERNAL)"
        tests:
          - accepted_values:
              values: ['ADMIN', 'INTERNAL']
      - name: committed_capital
        description: "Total committed capital"
      - name: called_capital
        description: "Total called capital"
      - name: dpi
        description: "Distributions to Paid-In capital ratio"
      - name: rvpi
        description: "Residual Value to Paid-In capital ratio"
      - name: created_at
        description: "Record creation timestamp"
        tests:
          - not_null
      - name: updated_at
        description: "Record last update timestamp"
        tests:
          - not_null

  - name: int_instrument_snapshots_curated
    description: "Curated instrument-level valuation snapshots from fund admin and PM systems"
    columns:
      - name: instrument_snapshot_id
        description: "Unique instrument snapshot identifier (surrogate key)"
        tests:
          - unique
          - not_null
      - name: instrument_id
        description: "Canonical instrument identifier"
        tests:
          - not_null
          - relationships:
              to: ref('int_instruments_unified')
              field: instrument_id
      - name: period_end_date
        description: "Snapshot period end date"
        tests:
          - not_null
      - name: frequency
        description: "Reporting frequency (QUARTERLY, ANNUAL)"
      - name: reporting_basis
        description: "Reporting basis (GAAP, IFRS)"
      - name: snapshot_source
        description: "Source of snapshot data (ADMIN, INTERNAL)"
        tests:
          - accepted_values:
              values: ['ADMIN', 'INTERNAL']
      - name: currency_code
        description: "Currency code for snapshot values"
      - name: fair_value
        description: "Fair value of instrument"
      - name: amortized_cost
        description: "Amortized cost basis"
      - name: equity_stake_pct
        description: "Equity ownership percentage"
      - name: created_at
        description: "Record creation timestamp"
        tests:
          - not_null
      - name: updated_at
        description: "Record last update timestamp"
        tests:
          - not_null

  - name: int_loan_snapshots_curated
    description: "Curated loan-level position snapshots (placeholder for future loan data)"
    columns:
      - name: loan_snapshot_id
        description: "Unique loan snapshot identifier (surrogate key)"
        tests:
          - unique
      - name: loan_id
        description: "Canonical loan identifier"
      - name: period_end_date
        description: "Snapshot period end date"
      - name: frequency
        description: "Reporting frequency (QUARTERLY, ANNUAL)"
      - name: reporting_basis
        description: "Reporting basis (GAAP, IFRS)"
      - name: snapshot_source
        description: "Source of snapshot data (ADMIN, INTERNAL)"
        tests:
          - accepted_values:
              values: ['ADMIN', 'INTERNAL']
              config:
                where: "loan_snapshot_id is not null"
      - name: principal_outstanding
        description: "Outstanding principal balance"
      - name: currency_code
        description: "Currency code for snapshot values"
      - name: created_at
        description: "Record creation timestamp"
      - name: updated_at
        description: "Record last update timestamp"

  - name: int_company_valuations_curated
    description: "Curated company valuation snapshots from PM system"
    columns:
      - name: company_valuation_id
        description: "Unique company valuation identifier (surrogate key)"
        tests:
          - unique
          - not_null
      - name: company_id
        description: "Canonical company identifier"
        tests:
          - not_null
          - relationships:
              to: ref('int_companies_unified')
              field: company_id
      - name: period_end_date
        description: "Valuation date"
        tests:
          - not_null
      - name: frequency
        description: "Reporting frequency (QUARTERLY, ANNUAL)"
      - name: reporting_basis
        description: "Reporting basis (GAAP, IFRS)"
      - name: snapshot_source
        description: "Source of valuation data (ADMIN, INTERNAL)"
        tests:
          - accepted_values:
              values: ['ADMIN', 'INTERNAL']
      - name: amount
        description: "Valuation amount"
      - name: valuation_type
        description: "Type of valuation (ACTUAL, FORECAST)"
        tests:
          - accepted_values:
              values: ['ACTUAL', 'FORECAST']
      - name: created_at
        description: "Record creation timestamp"
        tests:
          - not_null
      - name: updated_at
        description: "Record last update timestamp"
        tests:
          - not_null

  - name: int_company_financials_curated
    description: "Curated company financial statement snapshots from PM system"
    columns:
      - name: company_performance_snapshot_id
        description: "Unique company financial snapshot identifier (surrogate key)"
        tests:
          - unique
          - not_null
      - name: company_id
        description: "Canonical company identifier"
        tests:
          - not_null
          - relationships:
              to: ref('int_companies_unified')
              field: company_id
      - name: period_start_date
        description: "Financial period start date"
      - name: period_end_date
        description: "Financial period end date"
        tests:
          - not_null
      - name: frequency
        description: "Reporting frequency (ANNUAL, QUARTERLY)"
      - name: reporting_basis
        description: "Reporting basis (AUDITED, MANAGEMENT)"
      - name: snapshot_source
        description: "Source of financial data (ADMIN, INTERNAL)"
        tests:
          - accepted_values:
              values: ['ADMIN', 'INTERNAL']
      - name: currency_code
        description: "Currency code for financial values"
      - name: revenue
        description: "Total revenue"
      - name: ebitda
        description: "Earnings before interest, taxes, depreciation, and amortization"
      - name: net_income
        description: "Net income"
      - name: total_assets
        description: "Total assets"
      - name: total_liabilities
        description: "Total liabilities"
      - name: equity
        description: "Total equity"
      - name: created_at
        description: "Record creation timestamp"
        tests:
          - not_null
      - name: updated_at
        description: "Record last update timestamp"
        tests:
          - not_null
